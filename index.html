<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>カメラプレビュー</title>
</head>
<body>
  <h1>カメラプレビュー</h1>
  <video id="video" width="640" height="480" autoplay></video>
  <button id="stopButton">カメラ停止</button>
  
  <script>
    let stream;

    // カメラにアクセスする関数
    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('video');
        video.srcObject = stream;
      } catch (err) {
        console.error("カメラの取得に失敗しました: ", err);
        alert("カメラにアクセスできませんでした。許可を確認してください。");
      }
    }

    // カメラ停止の関数
    function stopCamera() {
      if (stream) {
        const tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
        console.log("カメラが停止しました。");
      }
    }

    document.getElementById('stopButton').addEventListener('click', stopCamera);

    // ブラウザに適応した関数を呼び出す
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      startCamera(); // カメラを開始
    } else if (navigator.webkitGetUserMedia) {
      navigator.webkitGetUserMedia({ video: true }, function(stream) {
        document.getElementById('video').srcObject = stream;
      }, function(err) {
        alert("Webkitブラウザでのカメラアクセスに失敗しました");
      });
    } else {
      alert("このブラウザはカメラ機能に対応していません");
    }
  </script>
</body>
</html>
